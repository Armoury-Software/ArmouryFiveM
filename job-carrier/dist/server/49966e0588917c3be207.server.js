(()=>{"use strict";var e,t;(t=e||(e={}))[t.SERVER_TO_SERVER=0]="SERVER_TO_SERVER",t[t.SERVER_TO_CLIENT=1]="SERVER_TO_CLIENT",t[t.CLIENT_TO_SERVER=2]="CLIENT_TO_SERVER",t[t.CLIENT_TO_CLIENT=3]="CLIENT_TO_CLIENT";const s=new Map,r=new Map,o=(e,t,s,r,o,i,a)=>e>=r-a&&e<=r+a&&t>=o-a&&t<=o+a&&s>=i-a&&s<=i+a,i=[-522.5355,-2866.82,4.00038];let a=class extends class extends class extends class extends class{constructor(){this.routingBucketCondition=(e,t)=>!0,this.assignServerBaseListeners()}RegisterAdminCommand(e,t,s,r){RegisterCommand(e,((e,r,o)=>{Number(global.exports.authentication.getPlayerInfo(e,"adminLevel"))<t||s(e,r,o)}),r)}assignServerBaseListeners(){onNet(`${GetCurrentResourceName()}:set-client-routing-bucket`,((e,t)=>{this.routingBucketCondition(e,t)&&SetEntityRoutingBucket(e,t)}))}}{removeClientsideVehicles(){TriggerClientEvent(`${GetCurrentResourceName()}:ARM_remove-vehicles`,-1)}}{}{constructor(){super(),this._jobInternalId="",this._spawnedVehicles=[],this._assignDefaultListeners(),this._jobInternalId=GetCurrentResourceName().split("-").slice(1).join(),GetCurrentResourceName().includes("job-")||console.error("You are using a Faction controller but its name does NOT comply with the naming 'job-<jobInternalId>'. The resource may not work properly.")}get jobInternalId(){return this._jobInternalId}get spawnedVehicles(){return this._spawnedVehicles}_assignDefaultListeners(){onNet("onResourceStop",(e=>{e===GetCurrentResourceName()&&this.removeVehicles()})),onNet("playerDropped",(()=>{}))}assignJob(e){global.exports.authentication.setPlayerInfo(e,"job",this._jobInternalId,!1),TriggerClientEvent(`${GetCurrentResourceName()}:job-assigned`,e)}removeVehicle(e,t){DoesEntityExist(e)&&DeleteEntity(e),this._spawnedVehicles.indexOf(e)>-1&&(t||this._spawnedVehicles.splice(this._spawnedVehicles.indexOf(e),1))}removeVehicles(){this._spawnedVehicles.forEach((e=>{this.removeVehicle(e,!0)})),this._spawnedVehicles=[]}}{constructor(){super(),this.carriers=new Map,this.savedPositions=new Map,this.assignEvents()}beginRouteForPlayer(e,t){const s=GetEntityCoords(GetPlayerPed(e),!0);let r;if(Array.from(this.savedPositions.keys()).forEach((e=>{o(s[0],s[1],s[2],e[0],e[1],e[2],15)&&(r=this.savedPositions.get(e).pos)})),!r){const e=this.getPossibleDeliveryPoints(s,15);r=e[Math.floor(Math.random()*e.length)].pos,this.savedPositions.set(s,{pos:r})}var i,a,n,c;this.carriers.set(source,{distance:(i=[s[0],s[1],s[2],r[0],r[1],r[2]],a=i[3]-i[0],n=i[4]-i[1],c=i[5]-i[2],Math.hypot(a,n,c)),packages:this.carriers.get(source).packages}),this.updatePackageUI(),TriggerClientEvent(`${GetCurrentResourceName()}:begin-route`,source,{X:r[0],Y:r[1],Z:r[2]-1},t),setTimeout((()=>{this.savedPositions.delete(s)}),1e4)}updatePackageUI(e=!0){this.carriers.has(source)&&(e?global.exports["armoury-overlay"].setMessage(source,{id:"carrier-packages",content:0===this.carriers.get(source).packages?"You have no packages left. Pick some up from the docks.":`You have ${this.carriers.get(source).packages}/15 packages left.`}):global.exports["armoury-overlay"].deleteMessage(source,{id:"carrier-packages"}))}getPossibleDeliveryPoints(e,t){const s=global.exports.businesses.getEntities().filter((e=>0!==e.depositX&&0!==e.depositY)).map((e=>({pos:[e.depositX,e.depositY,e.depositZ]})));return e&&t?s.filter((s=>!o(e[0],e[1],e[2],s.pos[0],s.pos[1],s.pos[2],t))):s}assignEvents(){onNet(`${GetCurrentResourceName()}:playerDropped`,(()=>{this.carriers.has(source)&&this.carriers.delete(source)})),onNet("baseevents:leftVehicle",(()=>{this.updatePackageUI(!1)})),onNet("baseevents:enteredVehicle",(()=>{GetEntityModel(GetVehiclePedIsIn(GetPlayerPed(source),!1))===GetHashKey("Mule")&&this.updatePackageUI()})),onNet(`${GetCurrentResourceName()}:quick-start`,((e=!1)=>{this.carriers.set(source,{distance:0,packages:15}),this.beginRouteForPlayer(source,!e)})),onNet(`${GetCurrentResourceName()}:get-job`,(()=>{this.assignJob(source)})),onNet(`${GetCurrentResourceName()}:route-finished`,(()=>{const e=GetEntityCoords(GetPlayerPed(source),!0);this.getPossibleDeliveryPoints().forEach((t=>{if(o(e[0],e[1],e[2],t.pos[0],t.pos[1],t.pos[2],10)&&GetEntityModel(GetVehiclePedIsIn(GetPlayerPed(source),!1))===GetHashKey("Mule"))return exports.authentication.setPlayerInfo(source,"cash",Number(exports.authentication.getPlayerInfo(source,"cash"))+(Math.floor(.14*this.carriers.get(source).distance)+Math.floor(100*Math.random())),!1),global.exports.skills.incrementPlayerSkill(source,"carrier",.01),console.log(this.carriers.get(source)),this.carriers.set(source,{distance:0,packages:this.carriers.get(source).packages-1}),void(0===this.carriers.get(source).packages?this.triggerPickup(source):this.beginRouteForPlayer(source,!1))}))}))}triggerPickup(e){this.updatePackageUI(),TriggerClientEvent(`${GetCurrentResourceName()}:pickup-route`,e,{X:i[0],Y:i[1],Z:i[2]})}};a=function(e,t,s,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(a=(i<3?o(a):i>3?o(t,s,a):o(t,s))||a);return i>3&&a&&Object.defineProperty(t,s,a),a}([function(t){return class extends t{constructor(...o){super(...o),s.has(t)&&s.get(t).forEach((([t,s,r])=>{r===e.CLIENT_TO_CLIENT?on(s,super[t].bind(this)):onNet(s,super[t].bind(this))})),r.has(t)&&r.get(t).forEach((e=>{exports(e,super[e].bind(this))}))}}}],a),new a})();