(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=t=>new Promise((e=>setTimeout(e,t))),i=(t,e,i,n,s,r,c)=>t>=n-c&&t<=n+c&&e>=s-c&&e<=s+c&&i>=r-c&&i<=r+c;var n=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function c(t){try{a(n.next(t))}catch(t){r(t)}}function o(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(c,o)}a((n=n.apply(t,e||[])).next())}))};new class extends class extends class extends class extends class{constructor(){this.tickInstance=null,this.tickFunctions=[],this.routingBucket=0,this.assignBaseListeners()}addToTick(...t){t.forEach((t=>{-1!==this.tickFunctions.findIndex((e=>e.id===t.id))&&console.error(`[ClientBase]: A tick function with the id ${t.id} already exists in the stack! The newly added tick function will not be executed.`)})),this.tickFunctions.push(...t),this.removeTickDuplicates(),this.refreshTicks()}addToTickUnique(...t){t.forEach((t=>{this.removeFromTick(t.id)})),this.addToTick(...t)}removeFromTick(t){this.tickFunctions=this.tickFunctions.filter((e=>e.id!=t))}refreshTicks(){this.tickInstance&&(clearTick(this.tickInstance),this.tickInstance=null),this.tickFunctions.length>0&&(this.tickInstance=setTick((()=>{return t=this,e=void 0,n=function*(){if(!this.tickFunctions.length)return clearTick(this.tickInstance),void(this.tickInstance=null);this.tickFunctions.forEach((t=>{t.function()}))},new((i=void 0)||(i=Promise))((function(s,r){function c(t){try{a(n.next(t))}catch(t){r(t)}}function o(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(c,o)}a((n=n.apply(t,e||[])).next())}));var t,e,i,n})))}removeTickDuplicates(){this.tickFunctions=this.tickFunctions.filter((t=>this.tickFunctions.findIndex((e=>e.id==t.id))==this.tickFunctions.indexOf(t)))}assignBaseListeners(){onNet(`${GetCurrentResourceName()}:set-routing-bucket`,(t=>{this.routingBucket=t}))}setEntityRoutingBucket(t){TriggerServerEvent(`${GetCurrentResourceName()}:set-client-routing-bucket`,t),this.routingBucket=t}}{constructor(){super(),this._blips=[],this._markers=[],this._vehicles=[],this.assignDefaultEntityListeners()}get blips(){return this._blips}get markers(){return this._markers}get vehicles(){return this._vehicles}createBlips(t){const e=t.map((t=>Object.assign(Object.assign({},t),{instance:null})));this._blips.push(...e),this.refreshBlips()}clearBlips(){this._blips.forEach((t=>{RemoveBlip(t.instance)})),this._blips=[]}refreshBlips(){this.blips.forEach((t=>{t.instance||(t.instance=AddBlipForCoord(t.pos[0],t.pos[1],t.pos[2]),SetBlipSprite(t.instance,t.id),SetBlipDisplay(t.instance,4),SetBlipScale(t.instance,1),SetBlipColour(t.instance,t.color),SetBlipAsShortRange(t.instance,!0),BeginTextCommandSetBlipName("STRING"),AddTextComponentString(t.title),EndTextCommandSetBlipName(t.instance))}))}createMarkers(t){const e=t.map((t=>Object.assign(Object.assign({},t),{instance:null})));this._markers.push(...e),this.refreshMarkers()}clearMarkers(){this._markers=[],this.removeFromTick(`${GetCurrentResourceName()}_markers`)}refreshMarkers(){this.addToTickUnique({id:`${GetCurrentResourceName()}_markers`,function:()=>n(this,void 0,void 0,(function*(){const t=GetEntityCoords(GetPlayerPed(-1),!0);this._markers.forEach((s=>n(this,void 0,void 0,(function*(){var n,r,c;if(i(t[0],t[1],t[2],s.pos[0],s.pos[1],s.pos[2],s.renderDistance)){if(s.textureDict&&!HasStreamedTextureDictLoaded(s.textureDict))for(RequestStreamedTextureDict(s.textureDict,!0);!HasStreamedTextureDictLoaded(s.textureDict);)yield e(100);DrawMarker(s.marker,s.pos[0],s.pos[1],s.pos[2],0,0,0,(null===(n=s.rotation)||void 0===n?void 0:n[0])||0,(null===(r=s.rotation)||void 0===r?void 0:r[1])||0,(null===(c=s.rotation)||void 0===c?void 0:c[2])||0,s.scale,s.scale,s.scale,s.rgba[0],s.rgba[1],s.rgba[2],s.rgba[3],!1,!0,2,!1,s.textureDict||null,s.textureName||null,!1),s.underlyingCircle&&DrawMarker(s.underlyingCircle.marker,s.pos[0],s.pos[1],s.pos[2]-.9,0,0,0,0,0,0,s.underlyingCircle.scale,s.underlyingCircle.scale,s.underlyingCircle.scale,s.underlyingCircle.rgba[0]||s.rgba[0],s.underlyingCircle.rgba[1]||s.rgba[1],s.underlyingCircle.rgba[2]||s.rgba[2],s.underlyingCircle.rgba[3]||s.rgba[3],!1,!0,2,!1,null,null,!1)}}))))}))})}createVehicleAsync(t,i,s,r,c,o,a,l=!1){return n(this,void 0,void 0,(function*(){let n=0;for(RequestModel(t);!HasModelLoaded(t);){if(n>10)return 0;yield e(100),n++}const u=CreateVehicle(t,i,s,r,c,o,a);return u&&(a&&this._vehicles.push(u),l&&TaskWarpPedIntoVehicle(GetPlayerPed(-1),u,-1)),u}))}removeVehicle(t){DoesEntityExist(t)&&DeleteEntity(t),this._vehicles.indexOf(t)>-1&&this._vehicles.splice(this._vehicles.indexOf(t),1)}assignDefaultEntityListeners(){onNet("onResourceStop",(t=>{t===GetCurrentResourceName()&&(this._vehicles.forEach((t=>{this.removeVehicle(t)})),this._vehicles=[])}))}}{constructor(){super(...arguments),this._actionPoints=[]}get actionPoints(){return this._actionPoints}createActionPoints(...t){this._actionPoints.push(...t),this.refreshActionPoints()}clearActionPoints(){this._actionPoints=[],this.removeFromTick(`${GetCurrentResourceName()}_actionpoints`)}removeActionPoint(t){this._actionPoints=this._actionPoints.filter((e=>!(t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1]&&t.pos[2]===e.pos[2]))),this._actionPoints.length||this.clearActionPoints()}refreshActionPoints(){this.addToTickUnique({id:`${GetCurrentResourceName()}_actionpoints`,function:()=>{const t=GetEntityCoords(GetPlayerPed(-1),!0);let e=[];this._actionPoints.forEach((n=>{i(t[0],t[1],t[2],n.pos[0],n.pos[1],n.pos[2],1*(IsPedInAnyVehicle(GetPlayerPed(-1),!1)?4:1))&&(n.action(),n.once&&e.push(n))})),e.length>0&&(e.forEach((t=>{this._actionPoints.splice(this._actionPoints.indexOf(t),1)})),e=[])}})}}{getPlayerInfo(e){let i=GetConvar(`${t.g.GetPlayerServerId(t.g.PlayerId())}_PI_${e}`,"-1");return i.toString().includes(";ARM;,")&&(i=i.split(";ARM;,")),i}}{constructor(){super(),this.assignCommands()}assignCommands(){setTick((()=>{return t=this,i=void 0,s=function*(){NetworkOverrideClockTime(12,0,0),yield e(1e4)},new((n=void 0)||(n=Promise))((function(e,r){function c(t){try{a(s.next(t))}catch(t){r(t)}}function o(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(c,o)}a((s=s.apply(t,i||[])).next())}));var t,i,n,s}))}}})();