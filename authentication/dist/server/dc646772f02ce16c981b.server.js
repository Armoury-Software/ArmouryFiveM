(()=>{"use strict";var e=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function r(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((a=a.apply(e,t||[])).next())}))};const t=[];function n(e,t,n,o=!0){let i=n;if(Array.isArray(n)&&(i=n.join(";ARM;,")),"cash"===t){global.exports["armoury-overlay"].updateItem(e,{id:"cash",icon:"attach_money",value:i});const t=a(e,"cash"),n=Number(i)-Number(t||0);0!==n&&0!==t&&global.exports["armoury-overlay"].showMoneyGainOverlay(e,n)}SetConvarReplicated(`${e}_PI_${t}`,i.toString()),o||global.exports.oxmysql.update(`UPDATE \`players\` SET ${t} = ? WHERE id = ?`,[i,a(e,"id")])}function a(e,t){let n=GetConvar(`${e}_PI_${t}`,"-1");return n.toString().includes(";ARM;,")&&(n=n.split(";ARM;,")),n}onNet("authentication:authenticate",(t=>{const n=source;t.isAuthenticating?setImmediate((()=>e(void 0,void 0,void 0,(function*(){const e=yield global.exports.oxmysql.single_async("SELECT * FROM `players` WHERE email=? AND password=?",[t.email,t.password]);e?(o(n,e),TriggerClientEvent("authentication:success",n,"test"),emit("authentication:player-authenticated",n)):TriggerClientEvent("authentication:login-error",n,"Authentication failed - incorrect email and password combination.")})))):setImmediate((()=>e(void 0,void 0,void 0,(function*(){try{const e=yield global.exports.oxmysql.insert_async("INSERT INTO `players`(`name`, `password`, `email`) VALUES (?, ?, ?)",["blank atm",t.password,t.email]);if(!e)throw new Error;o(n,e),TriggerClientEvent("authentication:success",n,"test"),TriggerServerEvent("authentication:player-authenticated",n)}catch(e){TriggerClientEvent("authentication:register-error",n,"Registration failed - that email already exists.")}}))))})),exports("getPlayerInfo",a),exports("setPlayerInfo",n);const o=(e,a)=>{for(var o in a)a.hasOwnProperty(o)&&(n(e,o,a[o]),-1!=t.indexOf(o)&&t.push(o))};on("playerDropped",(e=>{console.log(`Player ${GetPlayerName(global.source)} dropped (Reason: ${e}).`),function(e){t.forEach((t=>{SetConvarReplicated(`${e}_PI_${t}`,"-1")}))}(global.source)}))})();