(()=>{"use strict";var e,t;(t=e||(e={}))[t.SERVER_TO_SERVER=0]="SERVER_TO_SERVER",t[t.SERVER_TO_CLIENT=1]="SERVER_TO_CLIENT",t[t.CLIENT_TO_SERVER=2]="CLIENT_TO_SERVER",t[t.CLIENT_TO_CLIENT=3]="CLIENT_TO_CLIENT";const s=new Map,r=new Map,o=(e,t,s,r,o,n,i)=>e>=r-i&&e<=r+i&&t>=o-i&&t<=o+i&&s>=n-i&&s<=n+i;var n,i;!function(e){e[e.CARGO=0]="CARGO",e[e.ELECTRICITY=1]="ELECTRICITY",e[e.OIL=2]="OIL"}(n||(n={})),function(e){e[e.MAIN=0]="MAIN",e[e.LEGAL=1]="LEGAL",e[e.ILLEGAL=2]="ILLEGAL"}(i||(i={})),new Map([[n.OIL,[-1207431159,-730904777,1956216962]],[n.ELECTRICITY,[-2140210194]],[n.CARGO,[-1770643266,-877478386]]]);const c=[{pos:[1367.4593505859375,-1867.7406005859375,55.172119140625],type:n.OIL},{pos:[1398.2901611328125,-2062.23291015625,50.5216064453125],type:n.OIL},{pos:[2678.835205078125,1602.778076171875,23.03955078125],type:n.OIL},{pos:[2815.7802734375,1561.4505615234375,23.10693359375],type:n.ELECTRICITY},{pos:[2046.909912109375,3183.61328125,43.5626220703125],type:n.CARGO},{pos:[1567.79345703125,3791.630859375,32.8125],type:n.CARGO},{pos:[346.8791198730469,3418.773681640625,34.952392578125],type:n.ELECTRICITY},{pos:[258.0659484863281,2849.630859375,42.13037109375],type:n.ELECTRICITY},{pos:[592.5758056640625,2733.454833984375,40.6138916015625],type:n.CARGO}],a={OIL:.1,ELECTRICITY:.15,"CARGO 1":.12,"CARGO 2":.15,"CARGO 3":.24,"CARGO 4":.28};let u=class extends class extends class extends class extends class{constructor(){this.routingBucketCondition=(e,t)=>!0,this.assignServerBaseListeners()}RegisterAdminCommand(e,t,s,r){RegisterCommand(e,((e,r,o)=>{Number(global.exports.authentication.getPlayerInfo(e,"adminLevel"))<t||s(e,r,o)}),r)}assignServerBaseListeners(){onNet(`${GetCurrentResourceName()}:set-client-routing-bucket`,((e,t)=>{this.routingBucketCondition(e,t)&&SetEntityRoutingBucket(e,t)}))}}{removeClientsideVehicles(){TriggerClientEvent(`${GetCurrentResourceName()}:ARM_remove-vehicles`,-1)}}{}{constructor(){super(),this._jobInternalId="",this._spawnedVehicles=[],this._assignDefaultListeners(),this._jobInternalId=GetCurrentResourceName().split("-").slice(1).join(),GetCurrentResourceName().includes("job-")||console.error("You are using a Faction controller but its name does NOT comply with the naming 'job-<jobInternalId>'. The resource may not work properly.")}get jobInternalId(){return this._jobInternalId}get spawnedVehicles(){return this._spawnedVehicles}_assignDefaultListeners(){onNet("onResourceStop",(e=>{e===GetCurrentResourceName()&&this.removeVehicles()})),onNet("playerDropped",(()=>{}))}assignJob(e){global.exports.authentication.setPlayerInfo(e,"job",this._jobInternalId,!1),TriggerClientEvent(`${GetCurrentResourceName()}:job-assigned`,e)}removeVehicle(e,t){DoesEntityExist(e)&&DeleteEntity(e),this._spawnedVehicles.indexOf(e)>-1&&(t||this._spawnedVehicles.splice(this._spawnedVehicles.indexOf(e),1))}removeVehicles(){this._spawnedVehicles.forEach((e=>{this.removeVehicle(e,!0)})),this._spawnedVehicles=[]}}{constructor(){super(),this.truckers=new Map,this.savedPositions=new Map,this.assignEvents()}assignEvents(){onNet(`${GetCurrentResourceName()}:quick-start`,(e=>{const t=GetEntityCoords(GetPlayerPed(source),!0);let s;if(Array.from(this.savedPositions.keys()).forEach((r=>{n[e]===this.savedPositions.get(r).type&&o(t[0],t[1],t[2],r[0],r[1],r[2],15)&&(s=this.savedPositions.get(r).pos)})),!s){const r=c.filter((s=>!o(t[0],t[1],t[2],s.pos[0],s.pos[1],s.pos[2],30)&&s.type===this.decideDeliveryType(e)));s=r[Math.floor(Math.random()*r.length)].pos,this.savedPositions.set(t,{pos:s,type:n[e]})}var r,i,a,u;this.truckers.set(source,{distance:(r=[t[0],t[1],t[2],s[0],s[1],s[2]],i=r[3]-r[0],a=r[4]-r[1],u=r[5]-r[2],Math.hypot(i,a,u)),type:e}),console.log(this.truckers.get(source)),TriggerClientEvent(`${GetCurrentResourceName()}:begin-job`,source,{X:s[0],Y:s[1],Z:s[2]},e),setTimeout((()=>{this.savedPositions.delete(t)}),1e4)})),onNet(`${GetCurrentResourceName()}:get-job`,(()=>{global.exports.authentication.setPlayerInfo(source,"job","trucker",!1),TriggerClientEvent(`${GetCurrentResourceName()}:job-assigned`,source)})),onNet(`${GetCurrentResourceName()}:job-finished`,(()=>{const e=GetEntityCoords(GetPlayerPed(source),!0);c.forEach((t=>{if(o(e[0],e[1],e[2],t.pos[0],t.pos[1],t.pos[2],15))return exports.authentication.setPlayerInfo(source,"cash",Number(exports.authentication.getPlayerInfo(source,"cash"))+(Math.floor(this.truckers.get(source).distance*a[this.truckers.get(source).type])+Math.floor(Math.random()*a[this.truckers.get(source).type]*20)),!1),TriggerClientEvent(`${GetCurrentResourceName()}:force-showui`,source),global.exports.skills.incrementPlayerSkill(source,"trucker",.05),void(this.truckers.has(source)&&this.truckers.delete(source))}))}))}decideDeliveryType(e){switch(e){case"OIL":return 0;case"ELECTRICITY":return 1;default:return 2}}};u=function(e,t,s,r){var o,n=arguments.length,i=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(n<3?o(i):n>3?o(t,s,i):o(t,s))||i);return n>3&&i&&Object.defineProperty(t,s,i),i}([function(t){return class extends t{constructor(...o){super(...o),s.has(t)&&s.get(t).forEach((([t,s,r])=>{r===e.CLIENT_TO_CLIENT?on(s,super[t].bind(this)):onNet(s,super[t].bind(this))})),r.has(t)&&r.get(t).forEach((e=>{exports(e,super[e].bind(this))}))}}}],u),new u})();