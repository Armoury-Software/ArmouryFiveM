(()=>{"use strict";const e={onAccountAuthenticate:"authentication:account-success",onPlayerDeath:"armoury:onPlayerDeath",onPlayerAuthenticate:"authentication:player-authenticated",onPlayerDisconnect:"playerDropped",onResourceStop:"onResourceStop",onContextMenuItemPressed:"armoury-overlay:context-menu-item-pressed",onPlayerEnterVehicle:"armoury:onPlayerEnterVehicle",onPlayerExitVehicle:"armoury:onPlayerExitVehicle",onPlayerClientsidedCacheLoaded:"armoury:player-resource-cache-loaded"};var t;!function(e){e[e.SERVER_TO_SERVER=0]="SERVER_TO_SERVER",e[e.SERVER_TO_CLIENT=1]="SERVER_TO_CLIENT",e[e.CLIENT_TO_SERVER=2]="CLIENT_TO_SERVER",e[e.CLIENT_TO_CLIENT=3]="CLIENT_TO_CLIENT"}(t||(t={}));const r=new Map,o=new Map,n=new Map;function s(){return function(e){return class extends e{constructor(...s){super(...s),r.has(e)&&r.get(e).forEach((([e,r,o])=>{o===t.CLIENT_TO_CLIENT?on(r,super[e].bind(this)):onNet(r,super[e].bind(this))})),o.has(e)&&o.get(e).forEach((e=>{exports(e,super[e].bind(this))})),n.has(e)&&n.get(e).forEach((([e,t])=>{IsDuplicityVersion()?RegisterCommand(e.toLowerCase(),((r,o,n)=>{Number(global.exports.authentication.getPlayerInfo(r,"adminLevel"))<t||super[e].call(this,r,o,n)}),!1):RegisterCommand(e.toLowerCase(),((t,r,o)=>{super[e].call(this,r,o)}),!1)}))}}}}function i(o){return function(n,s,i){const a=e[s]||(null==o?void 0:o.eventName),l=(null==o?void 0:o.direction)||t.CLIENT_TO_SERVER;(null==a?void 0:a.length)?(r.has(n.constructor)||r.set(n.constructor,[]),r.get(n.constructor).some((([e,t,r])=>e===s))||r.get(n.constructor).push([s,a,l])):console.error(`${s} is not recognized as a default event, thus this listener won't work. Please use the eventName property inside the data parameter.`)}}var a=function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};let l=class extends class{constructor(){this.routingBucketCondition=(e,t)=>!0,this.assignServerBaseListeners()}RegisterAdminCommand(e,t,r,o){RegisterCommand(e,((e,o,n)=>{Number(global.exports.authentication.getPlayerInfo(e,"adminLevel"))<t||r(e,o,n)}),o)}assignServerBaseListeners(){onNet(`${GetCurrentResourceName()}:set-client-routing-bucket`,((e,t)=>{this.routingBucketCondition(e,t)&&SetEntityRoutingBucket(e,t)}))}}{constructor(){super(...arguments),this._virtualWorldsWithPlayers=new Map}get virtualWorldsWithPlayers(){return this._virtualWorldsWithPlayers}onPlayerEnteredScope(e){TriggerClientEvent(`${GetCurrentResourceName()}:refresh-virtual-world`,e.for)}setPlayerVirtualWorld(e,t){const r=this.getPlayerVirtualWorld(e);isNaN(r)||this._virtualWorldsWithPlayers.set(r,(this._virtualWorldsWithPlayers.has(r)?this._virtualWorldsWithPlayers.get(r):[]).filter((t=>t!==e)));const o=[...this._virtualWorldsWithPlayers.has(t)?this._virtualWorldsWithPlayers.get(t):[],e];this._virtualWorldsWithPlayers.set(t,o),global.exports.authentication.setPlayerInfo(e,"virtualWorld",t)}getPlayerVirtualWorld(e){return Math.max(0,Number(global.exports.authentication.getPlayerInfo(e,"virtualWorld")))}removeClientsideVehicles(){TriggerClientEvent(`${GetCurrentResourceName()}:ARM_remove-vehicles`,-1)}};a([i({eventName:"playerEnteredScope"})],l.prototype,"onPlayerEnteredScope",null),l=a([s()],l);var c=function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i};let u=class extends l{constructor(){super(...arguments),this._clientsidedResourceMap=new Map}get clientsidedResourceMap(){return this._clientsidedResourceMap}getPlayerClientsidedCacheKey(e,t){if(this._clientsidedResourceMap.has(e)){const r=this._clientsidedResourceMap.get(e);if(r[t])return r[t]}return null}updatePlayerClientsidedCacheKey(e,t,r){const o=this._clientsidedResourceMap.has(e)&&this._clientsidedResourceMap.get(e)||{};o[t]=r,this._clientsidedResourceMap.set(e,o),TriggerClientEvent("armoury-overlay:update-resource-metadata",e,GetCurrentResourceName(),t,r)}onPlayerClientsidedCacheLoaded(e){e[GetCurrentResourceName()]&&this._clientsidedResourceMap.set(source,e[GetCurrentResourceName()])}onPlayerDisconnect(){this._clientsidedResourceMap.has(source)&&this._clientsidedResourceMap.delete(source)}};c([i()],u.prototype,"onPlayerClientsidedCacheLoaded",null),c([i()],u.prototype,"onPlayerDisconnect",null),u=c([s()],u);const d={0:46,1:190,2:75,3:195,4:133,5:89,6:98,7:151,8:178,9:56,10:80,11:362};var p=function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},h=function(e,t,r,o){return new(r||(r=Promise))((function(n,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}l((o=o.apply(e,t||[])).next())}))};let m=class extends u{constructor(){super(),this.playersTestingClothingPairs=new Map,this.initializeTables()}onPairsShouldInitialize(e,t){return h(this,void 0,void 0,(function*(){const r=t||source,[o,n]=e.split("_").map((e=>this.getComponentIdByName(e))),[s,i]=yield this.getFirstIncompleteDrawableIdFor(o,n);SetPedComponentVariation(GetPlayerPed(r),o,s,0,0),SetPedComponentVariation(GetPlayerPed(r),n,i,0,0),this.playersTestingClothingPairs.has(r)||this.playersTestingClothingPairs.set(r,new Array(12).fill(0)),this.playersTestingClothingPairs.set(r,this.playersTestingClothingPairs.get(r).map(((e,t)=>t===o?s:t===n?i:(SetPedComponentVariation(GetPlayerPed(r),t,0,100,0),0)))),TriggerClientEvent(`${GetCurrentResourceName()}:update-for-peds`,r,this.playersTestingClothingPairs.get(r).map(((e,t)=>t!==o&&t!==n?-1:e)))}))}onDecisionHasBeenMade(e,t){return h(this,void 0,void 0,(function*(){const r=source,[o,n]=e.split("_").map((e=>this.getComponentIdByName(e)));console.log("onDecisionHasBeenMade: ",o,n);try{yield global.exports.oxmysql.insert_async("INSERT INTO `clothing_pairs` (`componentId`, `pairComponentId`, `drawableId`, `pairDrawableId`, `compatible`) VALUES (?, ?, ?, ?, ?)",[o,n,this.playersTestingClothingPairs.get(r).at(o),this.playersTestingClothingPairs.get(r).at(n),t]),this.onPairsShouldInitialize(e,r)}catch(e){TriggerClientEvent(`${GetCurrentResourceName()}:force-hideui`,r),global.exports.chat.addMessage(r,"A aparut o eroare la conexiune, te rog incearca din nou.")}}))}initializeTables(){return h(this,void 0,void 0,(function*(){try{yield global.exports.oxmysql.query_async("DESCRIBE clothing_pairs",[])}catch(e){console.error(`[${GetCurrentResourceName()}]: Table does not exist. Creating..`),yield global.exports.oxmysql.query_async("CREATE TABLE `clothing_pairs` ( `componentId` INT NOT NULL, `pairComponentId` INT NOT NULL, `drawableId` INT NOT NULL, `pairDrawableId` INT NOT NULL, `compatible` BOOLEAN NOT NULL ) ENGINE = InnoDB;",[]),console.log(`[${GetCurrentResourceName()}]: 'clothing-pairs' SQL table has been created!`)}}))}beginClothingPairing(e){return h(this,void 0,void 0,(function*(){const t=e;TriggerClientEvent(`${GetCurrentResourceName()}:force-showui`,t,{uppershirts_undershirts:{completed:yield this.getNumberOfCompletedDrawableIdsFor(11,8),max:d[11]*d[8],items:[0,1,2,3]},uppershirts_accessories:{completed:yield this.getNumberOfCompletedDrawableIdsFor(11,7),max:d[11]*d[7],items:[0,1,2,3]},uppershirts_hands:{completed:yield this.getNumberOfCompletedDrawableIdsFor(11,3),max:d[11]*d[3],items:[0,1,2,3]},uppershirts_pants:{completed:yield this.getNumberOfCompletedDrawableIdsFor(11,4),max:d[11]*d[4],items:[0,1,2,3]},undershirts_accessories:{completed:yield this.getNumberOfCompletedDrawableIdsFor(8,7),max:d[8]*d[7],items:[0,1,2,3]},undershirts_pants:{completed:yield this.getNumberOfCompletedDrawableIdsFor(8,4),max:d[8]*d[4],items:[0,1,2,3]},pants_shoes:{completed:yield this.getNumberOfCompletedDrawableIdsFor(4,6),max:d[4]*d[6],items:[0,1,2,3]}})}))}getFirstIncompleteDrawableIdFor(e,t){return h(this,void 0,void 0,(function*(){const r=Number(Object.values((yield global.exports.oxmysql.query_async(`SELECT MAX(drawableId) FROM clothing_pairs WHERE componentId = ${e} AND pairComponentId = ${t}`,[]))[0]).at(0));let o=Number(Object.values((yield global.exports.oxmysql.query_async(`SELECT COUNT(pairDrawableId) FROM clothing_pairs WHERE componentId = ${e} AND pairComponentId = ${t} AND drawableId = ${r}`,[]))[0]).at(0))-1;return o<d[t]?(console.log("returned here! (1)",[r,o+1]),[r,o+1]):r<d[e]?(console.log("returned here! (2)",[r+1,0]),[r+1,0]):void 0}))}getNumberOfCompletedDrawableIdsFor(e,t){return h(this,void 0,void 0,(function*(){return Number(Object.values((yield global.exports.oxmysql.query_async(`SELECT COUNT(pairDrawableId) FROM clothing_pairs WHERE componentId = ${e} AND pairComponentId = ${t}`,[]))[0]).at(0))}))}getComponentIdByName(e){switch(e){case"uppershirts":return 11;case"undershirts":return 8;case"accessories":return 7;case"pants":return 4;case"shoes":return 6;case"hands":return 3}}};p([i({eventName:`${GetCurrentResourceName()}:init-pairs`})],m.prototype,"onPairsShouldInitialize",null),p([i({eventName:`${GetCurrentResourceName()}:decision-made`})],m.prototype,"onDecisionHasBeenMade",null),p([function(e=0){return function(t,r,o){n.has(t.constructor)||n.set(t.constructor,[]),n.get(t.constructor).some((([e,t])=>e===r))||n.get(t.constructor).push([r,e])}}()],m.prototype,"beginClothingPairing",null),m=p([s()],m),new m})();