(()=>{"use strict";const e={onAccountAuthenticate:"authentication:account-success",onPlayerConnect:"playerJoining",onPlayerDeath:"armoury:onPlayerDeath",onPlayerAuthenticate:"authentication:player-authenticated",onPlayerDisconnect:"playerDropped",onResourceStop:"onResourceStop",onContextMenuItemPressed:"armoury-overlay:context-menu-item-pressed",onPlayerEnterVehicle:"armoury:onPlayerEnterVehicle",onPlayerExitVehicle:"armoury:onPlayerExitVehicle",onPlayerClientsidedCacheLoaded:"armoury:player-resource-cache-loaded",onPlayerStartTowVehicle:"armoury:onPlayerStartTowVehicle",onPlayerStopTowVehicle:"armoury:onPlayerStopTowVehicle"};var t;!function(e){e[e.SERVER_TO_SERVER=0]="SERVER_TO_SERVER",e[e.SERVER_TO_CLIENT=1]="SERVER_TO_CLIENT",e[e.CLIENT_TO_SERVER=2]="CLIENT_TO_SERVER",e[e.CLIENT_TO_CLIENT=3]="CLIENT_TO_CLIENT"}(t||(t={}));const r=new Map,n=new Map,o=new Map;function s(e){return function(s){return class extends s{constructor(...l){super(...l),this.translationFile=null==e?void 0:e.translationFile,r.has(s)&&r.get(s).forEach((([e,r,n])=>{n===t.CLIENT_TO_CLIENT?on(r,super[e].bind(this)):onNet(r,super[e].bind(this))})),n.has(s)&&n.get(s).forEach((e=>{exports(e,super[e].bind(this))})),o.has(s)&&o.get(s).forEach((([e,t])=>{IsDuplicityVersion()?RegisterCommand(((null==t?void 0:t.isKeyBinding)?"+":"")+e.toLowerCase(),((r,n,o)=>{(null==t?void 0:t.adminLevelRequired)&&Number(global.exports.authentication.getPlayerInfo(r,"adminLevel"))<(null==t?void 0:t.adminLevelRequired)||super[e].call(this,r,n,o)}),!1):RegisterCommand(((null==t?void 0:t.isKeyBinding)?"+":"")+e.toLowerCase(),((t,r,n)=>{super[e].call(this,r,n)}),!1)}))}}}}function l(n){return function(o,s,l){const a=e[s]||(null==n?void 0:n.eventName),i=(null==n?void 0:n.direction)||t.CLIENT_TO_SERVER;(null==a?void 0:a.length)?(r.has(o.constructor)||r.set(o.constructor,[]),r.get(o.constructor).some((([e,t,r])=>e===s))||r.get(o.constructor).push([s,a,i])):console.error(`${s} is not recognized as a default event, thus this listener won't work. Please use the eventName property inside the data parameter.`)}}function a(){return function(e,t,r){n.has(e.constructor)||n.set(e.constructor,[]),n.get(e.constructor).some((e=>e===t))||n.get(e.constructor).push(t)}}function i(e){return function(t,r,n){o.has(t.constructor)||o.set(t.constructor,[]),o.get(t.constructor).some((([e,t])=>e===r))||o.get(t.constructor).push([r,e||{}])}}var c=function(e,t,r,n){var o,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(l=(s<3?o(l):s>3?o(t,r,l):o(t,r))||l);return s>3&&l&&Object.defineProperty(t,r,l),l};let u=class extends class{constructor(){this.routingBucketCondition=(e,t)=>!0,this.assignServerBaseListeners()}RegisterAdminCommand(e,t,r,n){RegisterCommand(e,((e,n,o)=>{Number(global.exports.authentication.getPlayerInfo(e,"adminLevel"))<t||r(e,n,o)}),n)}assignServerBaseListeners(){onNet(`${GetCurrentResourceName()}:set-client-routing-bucket`,((e,t)=>{this.routingBucketCondition(e,t)&&SetEntityRoutingBucket(e,t)}))}setRoutingBucket(e,t){SetEntityRoutingBucket(GetPlayerPed(e),t),TriggerClientEvent(`${GetCurrentResourceName()}:set-routing-bucket`,e,t)}}{constructor(){super(...arguments),this._virtualWorldsWithPlayers=new Map}get virtualWorldsWithPlayers(){return this._virtualWorldsWithPlayers}onPlayerEnteredScope(e){TriggerClientEvent(`${GetCurrentResourceName()}:refresh-virtual-world`,e.for)}setPlayerVirtualWorld(e,t){const r=this.getPlayerVirtualWorld(e);isNaN(r)||this._virtualWorldsWithPlayers.set(r,(this._virtualWorldsWithPlayers.has(r)?this._virtualWorldsWithPlayers.get(r):[]).filter((t=>t!==e)));const n=[...this._virtualWorldsWithPlayers.has(t)?this._virtualWorldsWithPlayers.get(t):[],e];this._virtualWorldsWithPlayers.set(t,n),global.exports.authentication.setPlayerInfo(e,"virtualWorld",t)}getPlayerVirtualWorld(e){return Math.max(0,Number(global.exports.authentication.getPlayerInfo(e,"virtualWorld")))}removeClientsideVehicles(){TriggerClientEvent(`${GetCurrentResourceName()}:ARM_remove-vehicles`,-1)}};c([l({eventName:"playerEnteredScope"})],u.prototype,"onPlayerEnteredScope",null),u=c([s()],u);var y=function(e,t,r,n){var o,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(l=(s<3?o(l):s>3?o(t,r,l):o(t,r))||l);return s>3&&l&&Object.defineProperty(t,r,l),l};let d=class extends u{constructor(){super(...arguments),this._translationLanguage="en",this._clientsidedResourceMap=new Map}get translationLanguage(){return this._translationLanguage}get clientsidedResourceMap(){return this._clientsidedResourceMap}getPlayerClientsidedCacheKey(e,t){if(this._clientsidedResourceMap.has(e)){const r=this._clientsidedResourceMap.get(e);if(r[t])return r[t]}return null}updatePlayerClientsidedCacheKey(e,t,r){const n=this._clientsidedResourceMap.has(e)&&this._clientsidedResourceMap.get(e)||{};n[t]=r,this._clientsidedResourceMap.set(e,n),TriggerClientEvent("armoury-overlay:update-resource-metadata",e,GetCurrentResourceName(),t,r)}onPlayerClientsidedCacheLoaded(e){e[GetCurrentResourceName()]&&this._clientsidedResourceMap.set(source,e[GetCurrentResourceName()])}onPlayerDisconnect(){this._clientsidedResourceMap.has(source)&&this._clientsidedResourceMap.delete(source)}translate(e,t){let r=this.translationFile[this._translationLanguage][e];return t&&Object.keys(t).forEach((e=>{r=r.replace(`{${e}}`,t[e])})),r}setTranslationLanguage(e){this._translationLanguage=e}};y([l()],d.prototype,"onPlayerClientsidedCacheLoaded",null),y([l()],d.prototype,"onPlayerDisconnect",null),d=y([s()],d);var h=function(e,t,r,n){var o,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(l=(s<3?o(l):s>3?o(t,r,l):o(t,r))||l);return s>3&&l&&Object.defineProperty(t,r,l),l};let p=class extends d{constructor(){super(),this._players=[],this.playersBlockedOnTimes=new Map,this.registerTimers(),SetRoutingBucketPopulationEnabled(0,!1),this._players=[];try{const e=global.exports.authentication.getAuthenticatedPlayers();e.length&&(this._players=[...this._players,...e])}catch(e){console.error("Attempted to grab the authenticated players into armoury's connected players, but couldn't.")}}isVehicleNearbyPlayer(e,t,r=3.5){const n=GetEntityCoords(GetPlayerPed(t),!0),o=GetEntityCoords(e,!0);return s=[n[0],n[1],n[2],o[0],o[1],o[2]],l=s[3]-s[0],a=s[4]-s[1],i=s[5]-s[2],Math.hypot(l,a,i)<=r;var s,l,a,i}getVehiclesStillNearbyFrom(e,t){return t.filter((t=>this.isVehicleNearbyPlayer(NetworkGetEntityFromNetworkId(t[0]),e)))}blockPlayerTime(e,t,r,n){this.playersBlockedOnTimes.set(e,[t,r,n]),this.updateTimeForPlayers(e)}unblockPlayerTime(e){this.playersBlockedOnTimes.has(e)&&this.playersBlockedOnTimes.delete(e),this.updateTimeForPlayers(e)}onPlayerConnect(){this.setPlayerVirtualWorld(source,0),this.updateTimeForPlayers(source),this._players.push(source)}getPlayers(){return this._players}isPlayerOnline(e){return this._players.includes(e)}onPlayerDisconnect(){super.onPlayerDisconnect(),this.playersBlockedOnTimes.has(source)&&this.playersBlockedOnTimes.delete(source),this._players=this._players.filter((e=>e!==source))}language(e,[t]){"en"===t||"ro"===t?this.updatePlayerClientsidedCacheKey(e,"language",t):global.exports.chat.addMessage(e,"Unsupported language.")}blockMyTime(e,[t,r,n]){this.blockPlayerTime(e,Number(t),Number(r),Number(n))}unblockMyTime(e){this.unblockPlayerTime(e)}registerTimers(){this.updateTimeForPlayers(),setInterval((()=>{this.updateTimeForPlayers()}),6e4)}updateTimeForPlayers(e){const t=new Date;(e||this._players.length)&&(e?[e]:this._players).forEach((e=>{let r,n,o;this.playersBlockedOnTimes.has(e)&&([r,n,o]=this.playersBlockedOnTimes.get(e)),TriggerClientEvent(`${GetCurrentResourceName()}:update-time`,e,null!=r?r:t.getHours(),null!=n?n:t.getMinutes(),null!=o?o:t.getSeconds())}))}};h([a()],p.prototype,"isVehicleNearbyPlayer",null),h([a()],p.prototype,"getVehiclesStillNearbyFrom",null),h([a()],p.prototype,"blockPlayerTime",null),h([a()],p.prototype,"unblockPlayerTime",null),h([l()],p.prototype,"onPlayerConnect",null),h([a()],p.prototype,"getPlayers",null),h([a()],p.prototype,"isPlayerOnline",null),h([l()],p.prototype,"onPlayerDisconnect",null),h([i()],p.prototype,"language",null),h([i({adminLevelRequired:6})],p.prototype,"blockMyTime",null),h([i({adminLevelRequired:6})],p.prototype,"unblockMyTime",null),p=h([s()],p),new p})();