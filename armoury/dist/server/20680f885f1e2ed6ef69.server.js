(()=>{"use strict";const e={onPlayerDeath:"armoury:onPlayerDeath",onPlayerAuthenticate:"authentication:player-authenticated",onPlayerDisconnect:"playerDropped",onResourceStop:"onResourceStop",onContextMenuItemPressed:"armoury-overlay:context-menu-item-pressed",onPlayerEnterVehicle:"armoury:onPlayerEnterVehicle",onPlayerExitVehicle:"armoury:onPlayerExitVehicle",onPlayerClientsidedCacheLoaded:"armoury:player-resource-cache-loaded"};var t;!function(e){e[e.SERVER_TO_SERVER=0]="SERVER_TO_SERVER",e[e.SERVER_TO_CLIENT=1]="SERVER_TO_CLIENT",e[e.CLIENT_TO_SERVER=2]="CLIENT_TO_SERVER",e[e.CLIENT_TO_CLIENT=3]="CLIENT_TO_CLIENT"}(t||(t={}));const r=new Map,s=new Map,o=new Map;function n(){return function(e){return class extends e{constructor(...n){super(...n),r.has(e)&&r.get(e).forEach((([e,r,s])=>{s===t.CLIENT_TO_CLIENT?on(r,super[e].bind(this)):onNet(r,super[e].bind(this))})),s.has(e)&&s.get(e).forEach((e=>{exports(e,super[e].bind(this))})),o.has(e)&&o.get(e).forEach((([e,t])=>{RegisterCommand(e.toLowerCase(),((r,s,o)=>{Number(global.exports.authentication.getPlayerInfo(r,"adminLevel"))<t||super[e].call(this,r,s,o)}),!1)}))}}}}function i(s){return function(o,n,i){const a=e[n]||(null==s?void 0:s.eventName),l=(null==s?void 0:s.direction)||t.CLIENT_TO_SERVER;(null==a?void 0:a.length)?(r.has(o.constructor)||r.set(o.constructor,[]),r.get(o.constructor).some((([e,t,r])=>e===n))||r.get(o.constructor).push([n,a,l])):console.error(`${n} is not recognized as a default event, thus this listener won't work. Please use the eventName property inside the data parameter.`)}}function a(){return function(e,t,r){s.has(e.constructor)||s.set(e.constructor,[]),s.get(e.constructor).some((e=>e===t))||s.get(e.constructor).push(t)}}var l=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};let c=class extends class extends class{constructor(){this.routingBucketCondition=(e,t)=>!0,this.assignServerBaseListeners()}RegisterAdminCommand(e,t,r,s){RegisterCommand(e,((e,s,o)=>{Number(global.exports.authentication.getPlayerInfo(e,"adminLevel"))<t||r(e,s,o)}),s)}assignServerBaseListeners(){onNet(`${GetCurrentResourceName()}:set-client-routing-bucket`,((e,t)=>{this.routingBucketCondition(e,t)&&SetEntityRoutingBucket(e,t)}))}}{constructor(){super(...arguments),this._virtualWorldsWithPlayers=new Map}get virtualWorldsWithPlayers(){return this._virtualWorldsWithPlayers}setPlayerVirtualWorld(e,t){const r=this.getPlayerVirtualWorld(e);isNaN(r)||this._virtualWorldsWithPlayers.set(r,(this._virtualWorldsWithPlayers.has(r)?this._virtualWorldsWithPlayers.get(r):[]).filter((t=>t!==e)));const s=[...this._virtualWorldsWithPlayers.has(t)?this._virtualWorldsWithPlayers.get(t):[],e];this._virtualWorldsWithPlayers.set(t,s),global.exports.authentication.setPlayerInfo(e,"virtualWorld",t),TriggerClientEvent(`${GetCurrentResourceName()}:change-virtual-world`,e,t,s)}getPlayerVirtualWorld(e){return Math.max(0,Number(global.exports.authentication.getPlayerInfo(e,"virtualWorld")))}removeClientsideVehicles(){TriggerClientEvent(`${GetCurrentResourceName()}:ARM_remove-vehicles`,-1)}}{constructor(){super(...arguments),this._clientsidedResourceMap=new Map}get clientsidedResourceMap(){return this._clientsidedResourceMap}getPlayerClientsidedCacheKey(e,t){if(this._clientsidedResourceMap.has(e)){const r=this._clientsidedResourceMap.get(e);if(r[t])return r[t]}return null}updatePlayerClientsidedCacheKey(e,t,r){const s=this._clientsidedResourceMap.has(e)&&this._clientsidedResourceMap.get(e)||{};s[t]=r,this._clientsidedResourceMap.set(e,s),TriggerClientEvent("armoury-overlay:update-resource-metadata",e,GetCurrentResourceName(),t,r)}onPlayerClientsidedCacheLoaded(e){e[GetCurrentResourceName()]&&this._clientsidedResourceMap.set(source,e[GetCurrentResourceName()])}onPlayerDisconnect(){this._clientsidedResourceMap.has(source)&&this._clientsidedResourceMap.delete(source)}};l([i()],c.prototype,"onPlayerClientsidedCacheLoaded",null),l([i()],c.prototype,"onPlayerDisconnect",null),c=l([n()],c);var u=function(e,t,r,s){var o,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};let d=class extends c{constructor(){super(),this._players=[],this.registerFiveMEventListeners(),this.registerExports(),this.registerTimers(),SetRoutingBucketPopulationEnabled(0,!0),this._players=[];try{global.exports.authentication.getAuthenticatedPlayers()}catch(e){console.error("Attempted to grab the authenticated players into armoury's connected players, but couldn't.")}}isVehicleNearbyPlayer(e,t,r=3.5){const s=GetEntityCoords(GetPlayerPed(t),!0),o=GetEntityCoords(e,!0);return i=(n=[s[0],s[1],s[2],o[0],o[1],o[2]])[3]-n[0],a=n[4]-n[1],l=n[5]-n[2],Math.hypot(i,a,l)<=r;var n,i,a,l}getVehiclesStillNearbyFrom(e,t){return t.filter((t=>this.isVehicleNearbyPlayer(NetworkGetEntityFromNetworkId(t[0]),e)))}registerFiveMEventListeners(){onNet("playerJoining",((e,t)=>{this.setPlayerVirtualWorld(source,0),this._players.push(source)})),onNet("playerDropped",(e=>{this._players=this._players.filter((e=>e!==source))}))}getPlayers(){return this._players}registerExports(){exports("getPlayers",this.getPlayers.bind(this))}registerTimers(){const e=new Date;TriggerClientEvent(`${GetCurrentResourceName()}:update-time`,-1,e.getHours(),e.getMinutes(),e.getSeconds()),setInterval((()=>{const e=new Date;TriggerClientEvent(`${GetCurrentResourceName()}:update-time`,-1,e.getHours(),e.getMinutes(),e.getSeconds())}),6e4)}};u([a()],d.prototype,"isVehicleNearbyPlayer",null),u([a()],d.prototype,"getVehiclesStillNearbyFrom",null),d=u([n()],d),new d})();